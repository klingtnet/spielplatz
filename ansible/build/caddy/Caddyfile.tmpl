git.{{ domain }}:80 {
    import common.caddy
    redir https://git.{{ domain }}{uri}
}
git.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    proxy / localhost:{{ gitea_port }} {
        transparent
    }
}

pg.{{ domain }}:80 {
    import common.caddy
    redir https://pg.{{ domain }}{uri}
}
pg.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    basicauth / {{ user_name }} {{ user_password }}
    proxy / localhost:{{ pgweb_port }} {
        transparent
    }
}

prometheus.{{ domain }}:80 {
    import common.caddy
    redir https://prometheus.{{ domain }}{uri}
}
prometheus.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    basicauth / {{ user_name }} {{ user_password }}
    proxy / localhost:{{ prometheus_port }} {
        transparent
    }
}

jupyter.{{ domain }}:80 {
    import common.caddy
    redir https://jupyter.{{ domain }}{uri}
}
jupyter.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    basicauth / {{ user_name }} {{ user_password }}
    proxy / localhost:{{ jupyter_port }} {
        transparent
    }
}

grafana.{{ domain }}:80 {
    import common.caddy
    redir https://grafana.{{ domain }}{uri}
}
grafana.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    basicauth / {{ user_name }} {{ user_password }}
    proxy / localhost:{{ grafana_port }} {
        transparent
    }
}

restic.{{ domain }}:80 {
    import common.caddy
    redir https://restic.{{ domain }}{uri}
}
restic.{{ domain }}:443 {
    import common.caddy
    tls self_signed
    basicauth / {{ caddy_restic_user }} {{ caddy_restic_password }}
    restic / {{ caddy_restic_path }}
}
